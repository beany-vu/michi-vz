"use strict";(self.webpackChunkmichi_vz=self.webpackChunkmichi_vz||[]).push([[859],{"./src/components/DualHorizontalBarChart.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var d3__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/d3/src/index.js"),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),_components_MichiVzProvider__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/MichiVzProvider.tsx"),_components_shared_Title__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/shared/Title.tsx"),_hooks_useDisplayIsNodata__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/components/hooks/useDisplayIsNodata.ts"),_shared_LoadingIndicator__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/shared/LoadingIndicator.tsx"),_shared_XaxisLinear__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/components/shared/XaxisLinear.tsx"),_shared_YaxisBand__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/components/shared/YaxisBand.tsx"),use_deep_compare_effect__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/use-deep-compare-effect/dist/use-deep-compare-effect.esm.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var MARGIN={top:50,right:50,bottom:50,left:50},WIDTH=900-MARGIN.left-MARGIN.right,HEIGHT=480-MARGIN.top-MARGIN.bottom,DualHorizontalBarChart=function DualHorizontalBarChart(_ref){var _tooltip$data,_tooltip$data2,_tooltip$data3,dataSet=_ref.dataSet,filter=_ref.filter,title=_ref.title,_ref$width=_ref.width,width=void 0===_ref$width?WIDTH:_ref$width,_ref$height=_ref.height,height=void 0===_ref$height?HEIGHT:_ref$height,_ref$margin=_ref.margin,margin=void 0===_ref$margin?MARGIN:_ref$margin,yAxisFormat=_ref.yAxisFormat,xAxisFormat=_ref.xAxisFormat,_ref$xAxisDataType=_ref.xAxisDataType,xAxisDataType=void 0===_ref$xAxisDataType?"number":_ref$xAxisDataType,tooltipFormatter=_ref.tooltipFormatter,children=_ref.children,_ref$isLoading=_ref.isLoading,isLoading=void 0!==_ref$isLoading&&_ref$isLoading,isLoadingComponent=_ref.isLoadingComponent,isNodataComponent=_ref.isNodataComponent,isNodata=_ref.isNodata,onChartDataProcessed=_ref.onChartDataProcessed,onHighlightItem=_ref.onHighlightItem,_React$useState2=_slicedToArray(react__WEBPACK_IMPORTED_MODULE_1__.useState(null),2),tooltip=_React$useState2[0],setTooltip=_React$useState2[1],_useChartContext=(0,_components_MichiVzProvider__WEBPACK_IMPORTED_MODULE_2__.N)(),colorsMapping=_useChartContext.colorsMapping,colorsBasedMapping=_useChartContext.colorsBasedMapping,highlightItems=_useChartContext.highlightItems,disabledItems=_useChartContext.disabledItems,visibleItems=(_useChartContext.hiddenItems,_useChartContext.visibleItems),svgRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null),renderCompleteRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(!1),prevChartDataRef=(0,react__WEBPACK_IMPORTED_MODULE_1__.useRef)(null);(0,react__WEBPACK_IMPORTED_MODULE_1__.useLayoutEffect)((function(){renderCompleteRef.current=!0}),[]);var filteredDataSet=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)((function(){var result=dataSet.filter((function(d){return!disabledItems.includes(d.label)}));return filter&&(result=result.slice().sort((function(a,b){var _a$filter$criteria,_b$filter$criteria,aVal=null!==(_a$filter$criteria=a[filter.criteria])&&void 0!==_a$filter$criteria?_a$filter$criteria:0,bVal=null!==(_b$filter$criteria=b[filter.criteria])&&void 0!==_b$filter$criteria?_b$filter$criteria:0;return"desc"===filter.sortingDir?bVal-aVal:aVal-bVal})).slice(0,filter.limit)),result}),[dataSet,filter,disabledItems]),yAxisDomain=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)((function(){return filteredDataSet.filter((function(d){return!disabledItems.includes(d.label)})).map((function(d){return d.label}))}),[filteredDataSet]),xAxisDomain=(0,react__WEBPACK_IMPORTED_MODULE_1__.useMemo)((function(){var flattenedValues=filteredDataSet.filter((function(d){return!disabledItems.includes(d.label)})).map((function(d){return[d.value1,d.value2]})).flat();return"number"===xAxisDataType?[Math.max.apply(Math,_toConsumableArray(flattenedValues)),0]:"date_annual"===xAxisDataType||"date_monthly"===xAxisDataType?[new Date(Math.max.apply(Math,_toConsumableArray(flattenedValues)),1,1),new Date(0,1,1)]:[]}),[filteredDataSet,disabledItems,xAxisDataType]),yAxisScale=d3__WEBPACK_IMPORTED_MODULE_0__.scaleBand().domain(yAxisDomain).range([margin.top,height-margin.bottom]),xAxis1Scale=d3__WEBPACK_IMPORTED_MODULE_0__.scaleLinear().domain(xAxisDomain).range([width-margin.right,width/2]).clamp(!0).nice(1),xAxis2Scale=d3__WEBPACK_IMPORTED_MODULE_0__.scaleLinear().domain(xAxisDomain).range([margin.left,width/2]).clamp(!0).nice(1),handleMouseOver=function handleMouseOver(d,event){if(svgRef.current){var mousePoint=d3__WEBPACK_IMPORTED_MODULE_0__.pointer(event.nativeEvent,svgRef.current);setTooltip((function(){return{x:mousePoint[0],y:mousePoint[1],data:d}}))}},handleMouseOut=function handleMouseOut(){setTooltip(null)};(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)((function(){d3__WEBPACK_IMPORTED_MODULE_0__.select(svgRef.current).select(".bar").attr("opacity",.3),highlightItems.forEach((function(item){d3__WEBPACK_IMPORTED_MODULE_0__.select(svgRef.current).select(".bar-".concat(item.replaceAll(" ","-").replaceAll(",",""))).attr("opacity",1)}))}),[highlightItems]);var displayIsNodata=(0,_hooks_useDisplayIsNodata__WEBPACK_IMPORTED_MODULE_4__.x)({dataSet,isLoading,isNodataComponent,isNodata});return(0,use_deep_compare_effect__WEBPACK_IMPORTED_MODULE_8__.Ay)((function(){if(renderCompleteRef.current&&onChartDataProcessed){var uniqueLabels=_toConsumableArray(new Set(yAxisDomain)),currentMetadata={xAxisDomain:uniqueLabels,yAxisDomain:[Number(yAxisScale.domain()[0]),Number(yAxisScale.domain()[1])],visibleItems,renderedData:_defineProperty({},uniqueLabels[0],filteredDataSet),chartType:"dual-horizontal-bar-chart"};if(!prevChartDataRef.current||JSON.stringify(prevChartDataRef.current.xAxisDomain)!==JSON.stringify(currentMetadata.xAxisDomain)||JSON.stringify(prevChartDataRef.current.yAxisDomain)!==JSON.stringify(currentMetadata.yAxisDomain)||JSON.stringify(prevChartDataRef.current.visibleItems)!==JSON.stringify(currentMetadata.visibleItems)||JSON.stringify(Object.keys(prevChartDataRef.current.renderedData).sort())!==JSON.stringify(Object.keys(currentMetadata.renderedData).sort())){prevChartDataRef.current=currentMetadata;var timeoutId=setTimeout((function(){onChartDataProcessed(currentMetadata)}),0);return function(){return clearTimeout(timeoutId)}}}}),[yAxisDomain,xAxisDomain,visibleItems,filteredDataSet,onChartDataProcessed]),react__WEBPACK_IMPORTED_MODULE_1__.createElement("div",{style:{position:"relative"}},react__WEBPACK_IMPORTED_MODULE_1__.createElement("svg",{width,height,ref:svgRef,style:{overflow:"visible"},onMouseOut:function onMouseOut(event){event.stopPropagation(),event.preventDefault(),onHighlightItem([])}},children,react__WEBPACK_IMPORTED_MODULE_1__.createElement(_components_shared_Title__WEBPACK_IMPORTED_MODULE_3__.A,{x:width/2,y:margin.top/2},title),react__WEBPACK_IMPORTED_MODULE_1__.createElement(_shared_XaxisLinear__WEBPACK_IMPORTED_MODULE_6__.A,{xScale:xAxis1Scale,height,margin,xAxisFormat,xAxisDataType}),react__WEBPACK_IMPORTED_MODULE_1__.createElement(_shared_XaxisLinear__WEBPACK_IMPORTED_MODULE_6__.A,{xScale:xAxis2Scale,height,margin,xAxisFormat,xAxisDataType}),react__WEBPACK_IMPORTED_MODULE_1__.createElement(_shared_YaxisBand__WEBPACK_IMPORTED_MODULE_7__.A,{yScale:yAxisScale,width,margin,yAxisFormat}),filteredDataSet.filter((function(d){return!disabledItems.includes(d.label)})).map((function(d,i){var x1=xAxis1Scale(d.value1)-width/2,x2=xAxis2Scale(0)-xAxis2Scale(d.value2),y=yAxisScale(d.label)||0,standardHeight=yAxisScale.bandwidth();return react__WEBPACK_IMPORTED_MODULE_1__.createElement("g",{className:"bar bar-".concat(d.label.replaceAll(" ","-").replaceAll(",","")),key:i,style:{opacity:highlightItems.includes(d.label)||0===highlightItems.length?1:.3},onMouseOver:function onMouseOver(){return onHighlightItem([d.label])},onMouseOut:function onMouseOut(){return onHighlightItem([])}},react__WEBPACK_IMPORTED_MODULE_1__.createElement("rect",{x:width/2,y:y+(standardHeight-30)/2,width:x1,height:30,fill:colorsBasedMapping[d.label],rx:5,ry:5,onMouseOver:function onMouseOver(event){return handleMouseOver(d,event)},onMouseOut:handleMouseOut,stroke:"#fff"}),react__WEBPACK_IMPORTED_MODULE_1__.createElement("rect",{x:width/2-x2,y:y+(standardHeight-30)/2,width:x2,height:30,fill:colorsMapping[d.label],opacity:.8,rx:3,ry:3,onMouseOver:function onMouseOver(event){return handleMouseOver(d,event)},onMouseOut:handleMouseOut,stroke:"#fff"}),!d.value1&&!d.value2&&react__WEBPACK_IMPORTED_MODULE_1__.createElement(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,null,react__WEBPACK_IMPORTED_MODULE_1__.createElement("rect",{x:width/2-5,y:y+(standardHeight-30)/2,width:10,height:30,fill:colorsBasedMapping[d.label],rx:3,ry:3,onMouseOver:function onMouseOver(event){return handleMouseOver(d,event)},onMouseOut:handleMouseOut}),react__WEBPACK_IMPORTED_MODULE_1__.createElement("text",{x:width/2+15,y:y+(standardHeight-30)/2+20,fill:"black",fontSize:"12px",fontWeight:"bold"},"N/A")))}))),tooltip&&react__WEBPACK_IMPORTED_MODULE_1__.createElement("div",{style:{position:"absolute",left:"".concat(null==tooltip?void 0:tooltip.x,"px"),top:"".concat(null==tooltip?void 0:tooltip.y,"px"),background:"white",padding:"5px",pointerEvents:"none"}},!tooltipFormatter&&react__WEBPACK_IMPORTED_MODULE_1__.createElement("div",null,"$",null==tooltip||null===(_tooltip$data=tooltip.data)||void 0===_tooltip$data?void 0:_tooltip$data.label,": $",null==tooltip||null===(_tooltip$data2=tooltip.data)||void 0===_tooltip$data2?void 0:_tooltip$data2.value1," - $",null==tooltip||null===(_tooltip$data3=tooltip.data)||void 0===_tooltip$data3?void 0:_tooltip$data3.value2),tooltipFormatter&&tooltipFormatter(null==tooltip?void 0:tooltip.data)),isLoading&&isLoadingComponent&&react__WEBPACK_IMPORTED_MODULE_1__.createElement(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,null,isLoadingComponent),isLoading&&!isLoadingComponent&&react__WEBPACK_IMPORTED_MODULE_1__.createElement(_shared_LoadingIndicator__WEBPACK_IMPORTED_MODULE_5__.A,null),displayIsNodata&&react__WEBPACK_IMPORTED_MODULE_1__.createElement(react__WEBPACK_IMPORTED_MODULE_1__.Fragment,null,isNodataComponent))};const __WEBPACK_DEFAULT_EXPORT__=DualHorizontalBarChart;DualHorizontalBarChart.__docgenInfo={description:"",methods:[],displayName:"DualHorizontalBarChart",props:{dataSet:{required:!0,tsType:{name:"Array",elements:[{name:"DataPoint"}],raw:"DataPoint[]"},description:""},width:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"900 - MARGIN.left - MARGIN.right",computed:!1}},height:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"480 - MARGIN.top - MARGIN.bottom",computed:!1}},margin:{required:!1,tsType:{name:"signature",type:"object",raw:"{ top: number; right: number; bottom: number; left: number }",signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"right",value:{name:"number",required:!0}},{key:"bottom",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}}]}},description:"",defaultValue:{value:"{ top: 50, right: 50, bottom: 50, left: 50 }",computed:!1}},xAxisFormat:{required:!1,tsType:{name:"signature",type:"function",raw:"(d: number | { valueOf(): number }) => string",signature:{arguments:[{type:{name:"union",raw:"number | { valueOf(): number }",elements:[{name:"number"},{name:"signature",type:"object",raw:"{ valueOf(): number }",signature:{properties:[{key:"valueOf",value:{name:"number",required:!0}}]}}]},name:"d"}],return:{name:"string"}}},description:""},xAxisDataType:{required:!1,tsType:{name:"union",raw:'"number" | "date_annual" | "date_monthly"',elements:[{name:"literal",value:'"number"'},{name:"literal",value:'"date_annual"'},{name:"literal",value:'"date_monthly"'}]},description:"",defaultValue:{value:'"number"',computed:!1}},yAxisFormat:{required:!1,tsType:{name:"signature",type:"function",raw:"(d: number | string) => string",signature:{arguments:[{type:{name:"union",raw:"number | string",elements:[{name:"number"},{name:"string"}]},name:"d"}],return:{name:"string"}}},description:""},title:{required:!1,tsType:{name:"string"},description:""},tooltipFormatter:{required:!1,tsType:{name:"signature",type:"function",raw:"(\r\n  d: DataPoint | undefined,\r\n  dataSet?: {\r\n    label: string;\r\n    color: string;\r\n    series: DataPoint[];\r\n  }[]\r\n) => string",signature:{arguments:[{type:{name:"union",raw:"DataPoint | undefined",elements:[{name:"DataPoint"},{name:"undefined"}]},name:"d"},{type:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\r\n  label: string;\r\n  color: string;\r\n  series: DataPoint[];\r\n}",signature:{properties:[{key:"label",value:{name:"string",required:!0}},{key:"color",value:{name:"string",required:!0}},{key:"series",value:{name:"Array",elements:[{name:"DataPoint"}],raw:"DataPoint[]",required:!0}}]}}],raw:"{\r\n  label: string;\r\n  color: string;\r\n  series: DataPoint[];\r\n}[]"},name:"dataSet"}],return:{name:"string"}}},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isLoadingComponent:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},isNodataComponent:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},isNodata:{required:!1,tsType:{name:"union",raw:"boolean | ((dataSet: DataPoint[]) => boolean)",elements:[{name:"boolean"},{name:"unknown"}]},description:""},filter:{required:!1,tsType:{name:"signature",type:"object",raw:'{\r\n  limit: number; // new; replaces top\r\n  criteria: "valueBased" | "valueCompared"; // sorting criteria\r\n  sortingDir: "asc" | "desc";\r\n}',signature:{properties:[{key:"limit",value:{name:"number",required:!0}},{key:"criteria",value:{name:"union",raw:'"valueBased" | "valueCompared"',elements:[{name:"literal",value:'"valueBased"'},{name:"literal",value:'"valueCompared"'}],required:!0}},{key:"sortingDir",value:{name:"union",raw:'"asc" | "desc"',elements:[{name:"literal",value:'"asc"'},{name:"literal",value:'"desc"'}],required:!0}}]}},description:""},onChartDataProcessed:{required:!1,tsType:{name:"signature",type:"function",raw:"(metadata: ChartMetadata) => void",signature:{arguments:[{type:{name:"ChartMetadata"},name:"metadata"}],return:{name:"void"}}},description:""},onHighlightItem:{required:!1,tsType:{name:"signature",type:"function",raw:"(labels: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"labels"}],return:{name:"void"}}},description:""}}}}}]);