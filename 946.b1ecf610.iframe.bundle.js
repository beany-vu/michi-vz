"use strict";(self.webpackChunkmichi_vz=self.webpackChunkmichi_vz||[]).push([[946],{"./src/components/RibbonChart.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/react/index.js"),d3__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/d3/src/index.js"),_shared_Title__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/components/shared/Title.tsx"),_shared_XaxisBand__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/components/shared/XaxisBand.tsx"),_shared_YaxisLinear__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./src/components/shared/YaxisLinear.tsx"),_MichiVzProvider__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/components/MichiVzProvider.tsx"),_shared_LoadingIndicator__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./src/components/shared/LoadingIndicator.tsx"),_hooks_useDisplayIsNodata__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./src/components/hooks/useDisplayIsNodata.ts"),use_deep_compare_effect__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/use-deep-compare-effect/dist/use-deep-compare-effect.esm.js");function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){_defineProperty(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _defineProperty(e,r,t){return(r=function _toPropertyKey(t){var i=function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var MARGIN={top:50,right:50,bottom:50,left:50},RibbonChart=function RibbonChart(_ref){var series=_ref.series,_ref$width=_ref.width,width=void 0===_ref$width?900:_ref$width,_ref$height=_ref.height,height=void 0===_ref$height?480:_ref$height,_ref$margin=_ref.margin,margin=void 0===_ref$margin?MARGIN:_ref$margin,title=_ref.title,yAxisFormat=_ref.yAxisFormat,xAxisFormat=_ref.xAxisFormat,keys=_ref.keys,children=_ref.children,_ref$isLoading=_ref.isLoading,isLoading=void 0!==_ref$isLoading&&_ref$isLoading,isLoadingComponent=_ref.isLoadingComponent,isNodataComponent=_ref.isNodataComponent,isNodata=_ref.isNodata,tooltipContent=_ref.tooltipContent,onChartDataProcessed=_ref.onChartDataProcessed,onHighlightItem=_ref.onHighlightItem,_useChartContext=(0,_MichiVzProvider__WEBPACK_IMPORTED_MODULE_5__.N)(),colorsMapping=_useChartContext.colorsMapping,highlightItems=_useChartContext.highlightItems,disabledItems=_useChartContext.disabledItems,ref=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),renderCompleteRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(!1),prevChartDataRef=(0,react__WEBPACK_IMPORTED_MODULE_0__.useRef)(null),filteredDataSet=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return series.map((function(dataPoint){var filtered=_objectSpread({},dataPoint);return Object.keys(filtered).forEach((function(key){disabledItems.includes(key)&&"date"!==key&&delete filtered[key]})),filtered}))}),[series,disabledItems]),dates=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return filteredDataSet.map((function(d){return String(d.date)}))}),[filteredDataSet]),xScale=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return d3__WEBPACK_IMPORTED_MODULE_1__.scaleBand().domain(dates).range([margin.left,width-margin.right]).padding(.1)}),[filteredDataSet,width,margin,dates]),yScaleDomain=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return[0,d3__WEBPACK_IMPORTED_MODULE_1__.max(filteredDataSet,(function(d){return d3__WEBPACK_IMPORTED_MODULE_1__.sum(Object.keys(d).filter((function(key){return"date"!==key})).map((function(key){return d[key]||0})))||0}))]}),[filteredDataSet,keys]),yScale=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return d3__WEBPACK_IMPORTED_MODULE_1__.scaleLinear().domain(yScaleDomain).range([height-margin.bottom,margin.top]).clamp(!0).nice()}),[filteredDataSet,height,margin,yScaleDomain]),stackedRectData=(0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)((function(){return function prepareStackedData(seriesData){var stackedData=keys.reduce((function(acc,key){return acc[key]=null,acc}),{});return seriesData.forEach((function(yearData){var y0=0;_toConsumableArray(keys).filter((function(key){return!disabledItems.includes(key)})).sort((function(a,b){return(yearData[a]||0)-(yearData[b]||0)})).forEach((function(key){var y1=y0+(yearData[key]||0),rectData={key,height:yScale(y0)-yScale(y1),width:30,y:yScale(y1),x:xScale(String(yearData.date))+xScale.bandwidth()/2-15,fill:colorsMapping[key],data:yearData,certainty:yearData.certainty};y0=y1,stackedData=_objectSpread(_objectSpread({},stackedData),{},_defineProperty({},key,stackedData[key]?[stackedData[key],rectData].flat():[rectData]))}))})),stackedData}(filteredDataSet)}),[filteredDataSet,width,height,margin,disabledItems]),displayIsNodata=(0,_hooks_useDisplayIsNodata__WEBPACK_IMPORTED_MODULE_7__.x)({dataSet:filteredDataSet,isLoading,isNodataComponent,isNodata});return(0,react__WEBPACK_IMPORTED_MODULE_0__.useLayoutEffect)((function(){renderCompleteRef.current=!0}),[]),(0,use_deep_compare_effect__WEBPACK_IMPORTED_MODULE_8__.Ay)((function(){if(renderCompleteRef.current&&onChartDataProcessed){var currentMetadata={xAxisDomain:_toConsumableArray(new Set(dates)),yAxisDomain:Array.isArray(yScaleDomain)&&2===yScaleDomain.length?yScaleDomain:[0,yScaleDomain[1]||0],visibleItems:keys.filter((function(key){return!disabledItems.includes(key)})),renderedData:_defineProperty({},keys[0],filteredDataSet),chartType:"ribbon-chart"},hasChanged=!prevChartDataRef.current||JSON.stringify(prevChartDataRef.current.xAxisDomain)!==JSON.stringify(currentMetadata.xAxisDomain)||JSON.stringify(prevChartDataRef.current.yAxisDomain)!==JSON.stringify(currentMetadata.yAxisDomain)||JSON.stringify(prevChartDataRef.current.visibleItems)!==JSON.stringify(currentMetadata.visibleItems)||JSON.stringify(Object.keys(prevChartDataRef.current.renderedData).sort())!==JSON.stringify(Object.keys(currentMetadata.renderedData).sort());prevChartDataRef.current=currentMetadata,hasChanged&&onChartDataProcessed(currentMetadata)}}),[filteredDataSet,width,height,margin,disabledItems,dates,keys,yScaleDomain,onChartDataProcessed]),react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{style:{position:"relative"}},react__WEBPACK_IMPORTED_MODULE_0__.createElement("div",{className:"tooltip",style:{position:"absolute",background:"white",padding:"5px",border:"1px solid #333",pointerEvents:"none",zIndex:1e3}}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("svg",{className:"chart",ref,width,height,style:{overflow:"visible"},onMouseOut:function onMouseOut(event){event.preventDefault(),event.stopPropagation(),onHighlightItem([]),d3__WEBPACK_IMPORTED_MODULE_1__.select(".tooltip").style("visibility","hidden")}},children,react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_Title__WEBPACK_IMPORTED_MODULE_2__.A,{x:width/2,y:MARGIN.top/2},title),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_XaxisBand__WEBPACK_IMPORTED_MODULE_3__.A,{xScale,height,margin,xAxisFormat}),react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_YaxisLinear__WEBPACK_IMPORTED_MODULE_4__.A,{yScale,width,height,margin,highlightZeroLine:!0,yAxisFormat}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("g",null,keys.filter((function(key){return!disabledItems.includes(key)})).map((function(key){return react__WEBPACK_IMPORTED_MODULE_0__.createElement("g",{key:"stack-".concat(key,'.replaceAll(" ", "-").replaceAll(",", "")'),className:"stack-".concat(key,'.replaceAll(" ", "-").replaceAll(",", "")')},stackedRectData[key]&&stackedRectData[key].map((function(d,i){var _stackedRectData$key,_stackedRectData$key2,_stackedRectData$key3,_pointTopRight$x,_pointTopRight$y,pointTopLeft={x:d.x+d.width,y:d.y,height:d.height},pointTopRight={x:null===(_stackedRectData$key=stackedRectData[key][i+1])||void 0===_stackedRectData$key?void 0:_stackedRectData$key.x,y:null===(_stackedRectData$key2=stackedRectData[key][i+1])||void 0===_stackedRectData$key2?void 0:_stackedRectData$key2.y,height:null===(_stackedRectData$key3=stackedRectData[key][i+1])||void 0===_stackedRectData$key3?void 0:_stackedRectData$key3.height},topCurveControl="Q".concat(d.x+d.width," ").concat(d.y),segmentTopCurve="M".concat(pointTopLeft.x," ").concat(pointTopLeft.y," ").concat(topCurveControl," ").concat(null!==(_pointTopRight$x=pointTopRight.x)&&void 0!==_pointTopRight$x?_pointTopRight$x:0," ").concat(null!==(_pointTopRight$y=pointTopRight.y)&&void 0!==_pointTopRight$y?_pointTopRight$y:0),rightSideLine="V ".concat(pointTopRight.y+pointTopRight.height," "),segmentBottomCurve="Q".concat(d.x+d.width," ").concat(d.y+d.height," ").concat(pointTopLeft.x," ").concat(pointTopLeft.y+pointTopLeft.height," "),leftSideLine="V ".concat(pointTopLeft.y," "),pathD="".concat(segmentTopCurve," ").concat(rightSideLine," ").concat(segmentBottomCurve," ").concat(leftSideLine," Z");return react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,{key:"item-".concat(i)},i<stackedRectData[key].length-1&&react__WEBPACK_IMPORTED_MODULE_0__.createElement("path",{d:pathD,fill:d.fill,opacity:0===highlightItems.length||highlightItems.includes(d.key)?.4:.1,stroke:"#fff",strokeOpacity:.4,style:{transition:"opacity 0.1s ease-out"},onMouseOver:function onMouseOver(){return onHighlightItem([d.key])},onMouseOut:function onMouseOut(){return onHighlightItem([])}}),react__WEBPACK_IMPORTED_MODULE_0__.createElement("rect",{key:"item-".concat(i),x:d.x,y:d.y,width:d.width,height:d.height,fill:d.fill,rx:1.5,stroke:"#fff",strokeOpacity:.5,opacity:0===highlightItems.length||highlightItems.includes(d.key)?1:.1,ref:function ref(node){node&&d3__WEBPACK_IMPORTED_MODULE_1__.select(node).on("mouseover",(function(){onHighlightItem([d.key]),d3__WEBPACK_IMPORTED_MODULE_1__.select(".tooltip").style("visibility","visible").html((null==tooltipContent?void 0:tooltipContent(d.data))||function generateTooltipContent(data){var _xAxisFormat;return'\n    <div style="background: #fff; padding: 5px">\n      <p>'.concat(null!==(_xAxisFormat=null==xAxisFormat?void 0:xAxisFormat(String(data.date)))&&void 0!==_xAxisFormat?_xAxisFormat:data.date,"</p>\n      ").concat(Object.keys(data).filter((function(key){return"date"!==key})).map((function(key){var _data$key;return'<p style="color:'.concat(colorsMapping[key],'">').concat(key,": ").concat(null!==(_data$key=data[key])&&void 0!==_data$key?_data$key:"N/A","</p>")})).join(""),"\n    </div>")}(d.data))})).on("mousemove",(function(event){var _d3$pointer2=_slicedToArray(d3__WEBPACK_IMPORTED_MODULE_1__.pointer(event),2),x=_d3$pointer2[0],y=_d3$pointer2[1],tooltip=d3__WEBPACK_IMPORTED_MODULE_1__.select(".tooltip").node(),tooltipWidth=tooltip.getBoundingClientRect().width,tooltipHeight=tooltip.getBoundingClientRect().height;d3__WEBPACK_IMPORTED_MODULE_1__.select(".tooltip").style("left",x-tooltipWidth/2+"px").style("top",y-tooltipHeight-10+"px")})).on("mouseout",(function(){onHighlightItem([]),d3__WEBPACK_IMPORTED_MODULE_1__.select(".tooltip").style("visibility","hidden")}))}}))})))})))),isLoading&&isLoadingComponent&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,isLoadingComponent),isLoading&&!isLoadingComponent&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(_shared_LoadingIndicator__WEBPACK_IMPORTED_MODULE_6__.A,null),displayIsNodata&&react__WEBPACK_IMPORTED_MODULE_0__.createElement(react__WEBPACK_IMPORTED_MODULE_0__.Fragment,null,isNodataComponent))};const __WEBPACK_DEFAULT_EXPORT__=RibbonChart;RibbonChart.__docgenInfo={description:"",methods:[],displayName:"RibbonChart",props:{series:{required:!0,tsType:{name:"Array",elements:[{name:"DataPoint"}],raw:"DataPoint[]"},description:""},keys:{required:!0,tsType:{name:"Array",elements:[{name:"string"}],raw:"string[]"},description:""},width:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"900",computed:!1}},height:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"480",computed:!1}},margin:{required:!1,tsType:{name:"signature",type:"object",raw:"{ top: number; right: number; bottom: number; left: number }",signature:{properties:[{key:"top",value:{name:"number",required:!0}},{key:"right",value:{name:"number",required:!0}},{key:"bottom",value:{name:"number",required:!0}},{key:"left",value:{name:"number",required:!0}}]}},description:"",defaultValue:{value:"{ top: 50, right: 50, bottom: 50, left: 50 }",computed:!1}},title:{required:!1,tsType:{name:"string"},description:""},yAxisFormat:{required:!1,tsType:{name:"signature",type:"function",raw:"(d: number) => string",signature:{arguments:[{type:{name:"number"},name:"d"}],return:{name:"string"}}},description:""},xAxisFormat:{required:!1,tsType:{name:"signature",type:"function",raw:"(d: string | number) => string",signature:{arguments:[{type:{name:"union",raw:"string | number",elements:[{name:"string"},{name:"number"}]},name:"d"}],return:{name:"string"}}},description:""},children:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},isLoadingComponent:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},isNodataComponent:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},isNodata:{required:!1,tsType:{name:"union",raw:"boolean | ((dataSet: DataPoint[]) => boolean)",elements:[{name:"boolean"},{name:"unknown"}]},description:""},tooltipContent:{required:!1,tsType:{name:"signature",type:"function",raw:"(data: DataPoint) => string",signature:{arguments:[{type:{name:"DataPoint"},name:"data"}],return:{name:"string"}}},description:""},onChartDataProcessed:{required:!1,tsType:{name:"signature",type:"function",raw:"(metadata: ChartMetadata) => void",signature:{arguments:[{type:{name:"ChartMetadata"},name:"metadata"}],return:{name:"void"}}},description:""},onHighlightItem:{required:!1,tsType:{name:"signature",type:"function",raw:"(labels: string[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"string"}],raw:"string[]"},name:"labels"}],return:{name:"void"}}},description:""}}}}}]);